/*global window */

jQuery(document).ready(function() {
    var mbhVariables = {
        wrapper: jQuery('#mbh-results-wrapper'),
        formConfigId: '{{ configId }}',
        waitingText: '{{ "package.processing"|trans({}, 'front_messages')}}',
        urls: {
            table: '{{ urls.table }}',
            userForm: '{{ urls.user_form }}',
            paymentType: '{{ urls.payment_type }}',
            results: '{{ urls.results }}'
        }
    }

    var mbhResultForm = new MbhResultForm(mbhVariables);

    mbhResultForm.searchDataInit();

    window.addEventListener('resize', function(ev) {
        mbhResultForm.resize();
    })

    var getUrlVars = function() {
            var vars = [],
                hash;
            var hashes = mbhResultForm.searchData.url.split('&');

            if (hashes.length <= 1){
                console.log('Empty search data');
            }
            for (var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        },
        query = getUrlVars();

    var errorHtml = jQuery('#mbh-date-error').clone().removeClass('hide').attr('id', '');
    if (!query.begin || !query.end) {
        mbhResultForm.wrapper.html(errorHtml);
        return false;
    }
    mbhResultForm.waiting();

    // load table
    mbhResultForm.loadTable();
})
