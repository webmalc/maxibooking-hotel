services:
#roomCache generator
  mbh.room.cache.graph.generator:
    class: MBH\Bundle\PriceBundle\Services\RoomCacheGraphGenerator
    arguments: ['@mbh.helper', '@doctrine_mongodb']

  mbh.tariff.subscriber:
    class: MBH\Bundle\PriceBundle\EventListener\TariffSubscriber
    arguments: ['@service_container']
    tags:
      - { name: doctrine_mongodb.odm.event_subscriber, connection: default}

  mbh.room_cache.subscriber:
      class: MBH\Bundle\PriceBundle\EventListener\RoomCacheSubscriber
      arguments: ['@service_container']
      tags:
        - { name: doctrine_mongodb.odm.event_subscriber, connection: default}

  mbh.special.subscriber:
      class: MBH\Bundle\PriceBundle\EventListener\SpecialSubscriber
      arguments: ['@old_sound_rabbit_mq.task_calculate_special_prices_producer']
      tags:
        - { name: doctrine_mongodb.odm.event_subscriber, connection: default}

  mbh.room.cache:
          class: MBH\Bundle\PriceBundle\Services\RoomCache
          arguments: ['@service_container']

  mbh.price.cache:
          class: MBH\Bundle\PriceBundle\Services\PriceCache
          arguments: ['@service_container']

  mbh.price.cache.result_update:
      class: MBH\Bundle\PriceBundle\Services\PriceCacheResultUpdate
      arguments:
        - '@service_container'

  mbh.price_cache_generator_type:
      class: MBH\Bundle\PriceBundle\Form\PriceCacheGeneratorType
      arguments:
        - '%mbh.weekdays%'
      tags:
        - {name: form.type}

  mbh.restriction:
            class: MBH\Bundle\PriceBundle\Services\Restriction
            arguments: ['@service_container']

  task_room_cache_recalculate:
    class:      MBH\Bundle\PriceBundle\Task\RecalculateCache
    arguments:  ["@mbh.room.cache", "@mbh.task.logger", "@kernel"]

  task_special_recalculate:
    class:      MBH\Bundle\PriceBundle\Task\CalculateSpecialPrices
    arguments: ["@kernel"]

  task_cache_clear:
    class:      MBH\Bundle\BaseBundle\Task\CacheClear
    arguments: ["@mbh.cache"]


  mbh.special_handler:
    class: MBH\Bundle\PriceBundle\Services\SpecialHandler
    arguments: ['@mbh.package.search', '@doctrine_mongodb.odm.document_manager','@mbh.specials.logger', '@mbh.online.special_data_preparer', '@mbh.online.data_provider_special', '@mbh.online.search_form_data', '@mbh.notifier.mailer']

  mbh.type.special:
      class:      MBH\Bundle\PriceBundle\Form\SpecialType
      arguments:  ["@mbh.hotel.selector", "@mbh.package.search"]
      tags:
              - { name: form.type }

  mbh.type.special_filter:
        class:      MBH\Bundle\PriceBundle\Form\SpecialFilterType
        arguments:  ["@mbh.hotel.selector"]
        tags:
                - { name: form.type }

  mbh.type.tariff_filter:
        class:      MBH\Bundle\PriceBundle\Form\TariffFilterType
        arguments:  ["@mbh.hotel.selector"]
        tags:
                - { name: form.type }

  special_duplicate_search:
      class: MBH\Bundle\PriceBundle\Services\SpecialDuplicateSearch
      arguments: ['@doctrine_mongodb.odm.document_manager']

  mbh.special_display_dates_mass_changer:
    class: MBH\Bundle\PriceBundle\Services\SpecialDisplayDatesMassChanger
    arguments: ['@doctrine_mongodb.odm.document_manager']

  mbh.special_batch_type:
    class: MBH\Bundle\PriceBundle\Form\SpecialsTransformedType
    arguments: ['@doctrine_mongodb.odm.default_document_manager']
    tags:
      - {name: form.type}

  mbh.batch.promotion:
    class: MBH\Bundle\PriceBundle\Services\SpecialBatch\BatchHelper
    arguments: ['@doctrine_mongodb.odm.default_document_manager', 'getPromotion','setPromotion']

  mbh.batch.tariff:
    class: MBH\Bundle\PriceBundle\Services\SpecialBatch\BatchHelper
    arguments: ['@doctrine_mongodb.odm.default_document_manager', 'getTariff','setTariff']
