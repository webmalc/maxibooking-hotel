{% extends 'MBHHotelBundle:Flow:layout.html.twig' %}

{% set small_title = 'views.flow.rooms_flow.title'|trans({}, 'MBHHotelBundle') %}
{% set flowClass = 'MBH\\Bundle\\HotelBundle\\Form\\RoomTypeFlow\\RoomTypeFlow' %}
{% set isRoomTypeStep = flow.getStepId() == constant(flowClass ~ '::ROOM_TYPE_STEP') %}
{% set isHotelStep = flow.getStepId() == constant(flowClass ~ '::HOTEL_STEP') %}

{% if isRoomTypeStep %}
    {% form_theme form.roomType '@MBHHotel/Flow/docsListWithFlowProgressRates.html.twig' %}
{% endif %}

{% block flowBody %}
    {% set pathParams = {type: 'roomType'} %}
    {% if flow.flowConfig.flowId is empty %}
        {% if flow.stepId == constant(flowClass ~ '::ROOM_TYPE_STEP') %}
            {% set pathParams = pathParams|merge({'prevStep': flow.stepId, 'hotelId': flow.getManagedHotel().id}) %}
        {% endif %}
    {% else %}
        {% set pathParams = pathParams|merge({'flowId': flow.flowConfig.flowId}) %}
    {% endif %}

    {% set path = path('mb_flow', pathParams) %}

    {{ form_start(form, {'attr': {'class': 'form-horizontal'}, 'action': path }) }}
    {{ form_widget(form) }}

    {% if flow.stepId == constant(flowClass ~ '::PHOTOS_STEP') %}
        {% include '@MBHHotel/Hotel/image-list.html.twig' with {
            entityType: 'roomType',
            images: roomType.onlineImages,
            entity: roomType,
            showMakeMainButton: false,
            showDeleteButton: true,
            redirect_url: path
        } %}
    {% endif %}

    {% embed '@MBHHotel/Flow/flowButtons.html.twig' %}
        {% block additionalButtons %}
            {% if isRoomTypeStep or isHotelStep %}
                {% set titleId = isHotelStep ? 'views.flow.hotel_flow.add_hotel.title' : 'views.flow.hotel_flow.add_room_type.title' %}
                {% set buttonId = isHotelStep ? 'add-hotel-button' : 'add-roomtype-button' %}
                <li>
                    <button type="button" class="btn btn-success navbar-btn" id="{{ buttonId }}">
                        &nbsp;<i class="fa fa-plus"></i> {{ titleId|trans }}
                    </button>
                </li>
            {% endif %}
        {% endblock %}
    {% endembed %}

    {{ form_end(form) }}

    {% if isRoomTypeStep or isHotelStep %}
        <input type="hidden" value="{{ flow.managedHotel.id }}" id="flow-hotel-id">
        {% include '@MBHBase/modalWithForm.html.twig' with {modalTitle: 'Создание типа номера'} %}
    {% endif %}
{% endblock %}

{% block scripts %}
    {{ parent() }}
    {% if form.facilities is defined %}
        <script>
            $('#{{ (form.facilities.vars.id) }}').tagsSelectWidget({
                value: {% autoescape false %}{{ form.facilities.vars.value|json_encode }}{% endautoescape %},
                emptyHelp: '{{ 'form.roomTypeType.help.empty_facilities'|trans({}) }}'
            });
        </script>
    {% endif %}
{% endblock %}