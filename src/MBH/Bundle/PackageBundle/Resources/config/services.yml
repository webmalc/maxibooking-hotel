services:

    #begin: search
    mbh.package.search:
            class: MBH\Bundle\PackageBundle\Services\Search\SearchFactory
            shared: false
            arguments: ['@service_container']

    mbh.package.search_simple:
            class: MBH\Bundle\PackageBundle\Services\Search\Search
            arguments: ['@service_container']

    mbh.package.search_with_tariffs:
            class: MBH\Bundle\PackageBundle\Services\Search\SearchWithTariffs

    mbh.package.search_multiple_dates:
            class: MBH\Bundle\PackageBundle\Services\Search\SearchMultipleDates
            arguments: ['@service_container']
    #end: search

    mbh.tourists.messenger:
            class: MBH\Bundle\PackageBundle\Services\TouristsMessenger
            arguments: ['@service_container']

    mbh.calculation:
            class: MBH\Bundle\PackageBundle\Services\CalculationFactory
            factory: ['MBH\Bundle\PackageBundle\Services\CalculationFactory', createCalculation]
            arguments: ['@service_container']

    mbh.magic.calculation:
            class: MBH\Bundle\PackageBundle\Services\MagicCalculationFactory
            factory: ['MBH\Bundle\PackageBundle\Services\MagicCalculationFactory', createCalculation]
            arguments: ['@service_container']

    mbh.order_manager:
            class: MBH\Bundle\PackageBundle\Services\OrderManager
            arguments: ['@service_container']

    mbh.package.permissions:
            class: MBH\Bundle\PackageBundle\Services\Permissions
            arguments: ['@service_container']

    mbh.package.delete_reason.subscriber:
            class: MBH\Bundle\PackageBundle\EventListener\DeleteReasonSubscriber
            tags:
                - { name: doctrine_mongodb.odm.event_subscriber, connection: default}

    mbh.package.subscriber:
            class: MBH\Bundle\PackageBundle\EventListener\PackageSubscriber
            arguments: ['@service_container']
            tags:
                - { name: doctrine_mongodb.odm.event_subscriber, connection: default}

    mbh.package.order.subscriber:
            class: MBH\Bundle\PackageBundle\EventListener\OrderSubscriber
            arguments: ['@service_container']
            tags:
                - { name: doctrine_mongodb.odm.event_subscriber, connection: default}

    mbh.package.subscriber.tourist:
            class: MBH\Bundle\PackageBundle\EventListener\TouristSubscriber
            calls:
                - [setContainer, ['@service_container']]
            tags:
                - { name: doctrine_mongodb.odm.event_subscriber, connection: default}

    mbh.package.subsciber.search:
            class: MBH\Bundle\PackageBundle\EventListener\SearchSubscriber
            arguments: ['@service_container']
            tags:
                - { name: kernel.event_subscriber, event: search.calculation }

    mbh.package.validator:
            class: MBH\Bundle\PackageBundle\Validator\Constraints\PackageValidator
            arguments: ['@service_container']
            tags:
                - { name: validator.constraint_validator, alias: mbh.package.validator }

    mbh.package.form.type.birthplace:
            class: MBH\Bundle\PackageBundle\Form\BirthplaceType
            tags:
                - { name: form.type, alias: mbh_birthplace }

    mbh.package.form.type.address_object_decomposed:
            class: MBH\Bundle\PackageBundle\Form\AddressObjectDecomposedType
            tags:
                - { name: form.type, alias: mbh_address_object_decomposed }

    mbh.package.form.type.document_relation:
            class: MBH\Bundle\PackageBundle\Form\DocumentRelationType
            calls:
                   - [setDictionaryProvider, ['@mbh.vega.dictionary_provider']]
                   - [setManagerRegistry, ['@doctrine_mongodb']]
            tags:
                - { name: form.type, alias: mbh_document_relation }
    mbh.package.document_tempalte_factory:
            class: MBH\Bundle\PackageBundle\DocumentGenerator\Template\TemplateGeneratorFactory
            calls:
                   - [setContainer, ['@service_container']]
    mbh.package.document_xls_factory:
            class: MBH\Bundle\PackageBundle\DocumentGenerator\Xls\XlsGeneratorFactory
            calls:
                   - [setContainer, ['@service_container']]
    mbh.package.document_factory:
            class: MBH\Bundle\PackageBundle\DocumentGenerator\ChainGeneratorFactory
            calls:
                   - [addFactory, ['@mbh.package.document_tempalte_factory']]
                   - [addFactory, ['@mbh.package.document_xls_factory']]
                   - [setContainer, ['@service_container']]

    mbh.package.unwelcome_repository:
            class: MBH\Bundle\PackageBundle\Document\UnwelcomeRepository
            arguments: ['@mbh.mbhs']

    mbh.package.report.filling_report_generator:
            class: MBH\Bundle\PackageBundle\Component\FillingReportGenerator
            calls:
                   - [setContainer, ['@service_container']]
    mbh.package.payer_repository:
            class: MBH\Bundle\PackageBundle\Document\PayerRepository
            calls:
                   - [setContainer, ['@service_container']]

    mbh.package.windows.report.generator:
      class: MBH\Bundle\PackageBundle\Services\WindowsReportGenerator
      arguments: ['@mbh.helper', '@doctrine_mongodb']

    mbh.package.csv.generator:
          class: MBH\Bundle\PackageBundle\Services\CsvGenerate
          arguments: ['@service_container']

    mbh.package.dynamic.sales.generator:
              class: MBH\Bundle\PackageBundle\Services\DynamicSalesGenerator
              arguments:
                  - '@doctrine.odm.mongodb.document_manager'
                  - '@mbh.helper'
                  - '@translator'
                  - '%mbh_dynamic_sale_period%'
                  - '@service_container'

#    mbh.acl_document_owner_maker:
#        class: MBH\Bundle\PackageBundle\Lib\AclOwnerMaker
#        arguments: ['@security.acl.provider', '@doctrine.odm.mongodb.document_manager']

    task_notice_unpaid_order:
      class:      MBH\Bundle\PackageBundle\Task\TaskNoticeUnpaidOrder
      arguments:  ["@mbh.notice.unpaid"]

    mbh.package.virtual_room_handler:
        class: MBH\Bundle\PackageBundle\Services\VirtualRoomHandler
        arguments:
            - '@doctrine_mongodb.odm.document_manager'
            - '@mbh.package.search_simple'
            - '@mbh.virtual_room_handler.logger'
            - '@translator.default'

    mbh.virtual_room_handler.logger:
        class:     Symfony\Bridge\Monolog\Logger
        arguments: [virtual_room_moving]
        calls:
            - [pushHandler, ['@mbh.virtual_room_handler.logger_handler']]

    mbh.virtual_room_handler.logger_handler:
        class:     Monolog\Handler\StreamHandler
        arguments: ['%kernel.logs_dir%/%kernel.environment%.virtualRoom.log', 200]

    mbh.task_prepare_package_moving_report:
        class: MBH\Bundle\PackageBundle\Task\PreparePackageMovingReport
        arguments:
            - '@mbh.package_moving'
            - '@doctrine_mongodb.odm.document_manager'

    mbh.packages_daily_report_compiler:
        class: MBH\Bundle\PackageBundle\Services\PackagesDailyReportCompiler
        arguments:
            - '@doctrine.odm.mongodb.document_manager'
            - '@mbh.report'
            - '@translator'
            - '@mbh.calculation'

    mbh.distribution_report_compiler:
        class: MBH\Bundle\PackageBundle\Services\DistributionReportCompiler
        arguments:
            - '@doctrine.odm.mongodb.document_manager'
            - '@mbh.report'
            - '@translator'


    mbh.dynamic_sales_report.dynamic_sales_day:
      class: MBH\Bundle\PackageBundle\Lib\DynamicSalesDay
      arguments: ['@doctrine.odm.mongodb.document_manager']
      shared: false

    mbh.reservation_report:
        class: MBH\Bundle\PackageBundle\Services\ReservationReportCompiler
        arguments:
            - '@doctrine.odm.mongodb.document_manager'
            - '@mbh.report'
            - '@translator'
            - '@mbh.helper'
            - '@mbh.calculation'