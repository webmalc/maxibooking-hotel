services:
    mbh_search.search_query_generator:
        class: MBH\Bundle\SearchBundle\Services\SearchQueryGenerator
        arguments: ['@doctrine.odm.mongodb.document_manager', '@mbh_search.additional_days_generator', '@mbh_search.room_type_fetcher']

    mbh_search.search_request_receiver:
        class: MBH\Bundle\SearchBundle\Services\SearchRequestReceiver
        arguments: ["@form.factory"]

    mbh_search.additional_days_generator:
        class: MBH\Bundle\SearchBundle\Services\AdditionalDatesGenerator

    mbh_search.restrictions_checker_service:
        class: MBH\Bundle\SearchBundle\Services\RestrictionsCheckerService
        calls:
            - [addChecker, ['@mbh_search.restrictions.on_close']]
            - [addChecker, ['@mbh_search.restrictions.on_close_arrival']]
            - [addChecker, ['@mbh_search.restrictions.on_close_departure']]
            - [addChecker, ['@mbh_search.restrictions.on_max_before_arrival']]
            - [addChecker, ['@mbh_search.restrictions.on_max_guest']]
            - [addChecker, ['@mbh_search.restrictions.on_max_stay']]
            - [addChecker, ['@mbh_search.restrictions.on_max_stay_arrival']]
            - [addChecker, ['@mbh_search.restrictions.on_min_before_arrival']]
            - [addChecker, ['@mbh_search.restrictions.on_min_guest']]
            - [addChecker, ['@mbh_search.restrictions.on_min_stay']]
            - [addChecker, ['@mbh_search.restrictions.on_min_stay_arrival']]

        arguments: ['@doctrine.odm.mongodb.document_manager']

    mbh_search.restrictions.on_close:
        public: false
        class: MBH\Bundle\SearchBundle\Lib\Restrictions\Closed

    mbh_search.restrictions.on_close_arrival:
        public: false
        class: MBH\Bundle\SearchBundle\Lib\Restrictions\ClosedOnArrival

    mbh_search.restrictions.on_close_departure:
        public: false
        class: MBH\Bundle\SearchBundle\Lib\Restrictions\ClosedOnDeparture

    mbh_search.restrictions.on_max_before_arrival:
        public: false
        class: MBH\Bundle\SearchBundle\Lib\Restrictions\MaxBeforeArrival

    mbh_search.restrictions.on_max_guest:
        public: false
        class: MBH\Bundle\SearchBundle\Lib\Restrictions\MaxGuest

    mbh_search.restrictions.on_max_stay:
        public: false
        class: MBH\Bundle\SearchBundle\Lib\Restrictions\MaxStay

    mbh_search.restrictions.on_max_stay_arrival:
        public: false
        class: MBH\Bundle\SearchBundle\Lib\Restrictions\MaxStayArrival

    mbh_search.restrictions.on_min_before_arrival:
        public: false
        class: MBH\Bundle\SearchBundle\Lib\Restrictions\MinBeforeArrival

    mbh_search.restrictions.on_min_guest:
        public: false
        class: MBH\Bundle\SearchBundle\Lib\Restrictions\MinGuest

    mbh_search.restrictions.on_min_stay:
        public: false
        class: MBH\Bundle\SearchBundle\Lib\Restrictions\MinStay

    mbh_search.restrictions.on_min_stay_arrival:
        public: false
        class: MBH\Bundle\SearchBundle\Lib\Restrictions\MinStayArrival

    #search
    mbh_search.searcher:
        class: MBH\Bundle\SearchBundle\Services\Search\Searcher
        arguments: ["@doctrine_mongodb.odm.default_document_manager", '@mbh_search.restrictions_checker_service', '@mbh_search.search_limit_checker']

    mbh_search.room_cache_search_provider:
        class: MBH\Bundle\SearchBundle\Services\Search\RoomCacheSearchProvider
        arguments: ["@mbh_search.room_cache_repository", "%mbh_cache%"]

    mbh_search.search_limit_checker:
        class: MBH\Bundle\SearchBundle\Services\Search\SearchLimitChecker
        arguments: ['@mbh_search.room_cache_search_provider']

    mbh_search.room_type_repository:
        class: MBH\Bundle\HotelBundle\Document\RoomTypeRepository
        factory: ["@doctrine.odm.mongodb.document_manager", getRepository]
        arguments:
            - MBH\Bundle\HotelBundle\Document\RoomType

    mbh_search.room_cache_repository:
        class: MBH\Bundle\PriceBundle\Document\RoomCacheRepository
        factory: ["@doctrine.odm.mongodb.document_manager", getRepository]
        arguments:
            - MBH\Bundle\PriceBundle\Document\RoomCache

    mbh_search.room_type_fetcher:
        class: MBH\Bundle\SearchBundle\Services\RoomTypeFetcher
        arguments: ['@doctrine.odm.mongodb.document_manager','@mbh_search.room_type_repository']