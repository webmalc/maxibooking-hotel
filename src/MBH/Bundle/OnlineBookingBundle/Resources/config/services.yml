services:
#    mbh_online_booking.example:
#        class: MBH\Bundle\OnlineBookingBundle\Example
#        arguments: [@service_id, "plain_value", %parameter%]
    mbh.online.search_form:
        class: MBH\Bundle\OnlineBookingBundle\Form\SearchFormType
        arguments: ["@service_container"]
        tags:
            - { name: form.type }

    mbh.sign_form:
        class: MBH\Bundle\OnlineBookingBundle\Form\SignType
        arguments: ["@service_container"]
        tags:
            - { name: form.type }

    mbh.reservation_form:
        class: MBH\Bundle\OnlineBookingBundle\Form\ReservationType
        arguments: ["@service_container"]
        tags:
            - { name: form.type }

    mbh.online.chart.data.former:
        class: MBH\Bundle\OnlineBookingBundle\Service\ChartDataFormer
        arguments: ["@mbh.calculation"]


    mbh.online.special.sorter_date:
        class: MBH\Bundle\OnlineBookingBundle\Service\Sorters\SpecialSorterDate

    mbh.online.special.sorter_price:
        class: MBH\Bundle\OnlineBookingBundle\Service\Sorters\SpecialSorterPrice

    mbh.online.special.no_sort:
        class: MBH\Bundle\OnlineBookingBundle\Service\Sorters\SpecialNoSorter

    mbh.online.special_data_preparer:
        class: MBH\Bundle\OnlineBookingBundle\Service\SpecialDataPreparer
        arguments: ['@doctrine.odm.mongodb.document_manager', '%online_booking%', '@mbh.online.special.no_sort']

    mbh.online.special_data_preparer.date_sort:
        class: MBH\Bundle\OnlineBookingBundle\Service\SpecialDataPreparer
        arguments: ['@doctrine.odm.mongodb.document_manager', '%online_booking%', '@mbh.online.special.sorter_date']

    mbh.online.special_data_preparer.price_sort:
            class: MBH\Bundle\OnlineBookingBundle\Service\SpecialDataPreparer
            arguments: ['@doctrine.odm.mongodb.document_manager', '%online_booking%', '@mbh.online.special.sorter_price']

    mbh.online.search_form_data:
        class: MBH\Bundle\OnlineBookingBundle\Lib\OnlineSearchFormData
        arguments: ['@mbh.hotel.room_type_manager']


# TODO: Будет время - сделать фабрику.
    mbh.online.search_helper:
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\OnlineSearchHelper
        arguments: ['%online_booking%', '@mbh.helper']
        calls:
            - [addDataProvider, ['@mbh.online.data_provider_common']]
            - [addDataProvider, ['@mbh.online.data_provider_special']]
            - [setAdditionalProvider, ['@mbh.online.data_provider_additional']]
###
    mbh.online.data_provider_common:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\OnlineDataProviderWrapper
        arguments: ["@mbh.common_data_provider", "@mbh.online.common_sorter", "%mbh_cache%"]

    mbh.online.data_provider_special:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\OnlineDataProviderWrapper
        arguments: ["@mbh.special_data_provider", "@mbh.online.special_sorter"]

    mbh.online.data_provider_additional:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\OnlineDataProviderWrapper
        arguments: ["@mbh.additional_data_provider", "@mbh.online.additional_sorter"]
###
    mbh.common_data_provider:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\DataProviders\CommonDataProvider
        arguments:
            - '@mbh.online.search_adapter'
            - '@mbh.online.common_result_creator'
            - '@mbh.online.query_generator'
            - '%online_booking%'

    mbh.online.search_adapter:
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\OnlineSearchAdapter
        arguments:
            - '@mbh_search.search'
            - '@doctrine.odm.mongodb.document_manager'
            - '@mbh.package.search'
            - '@mbh_search.shared_data_fetcher'

    mbh.special_data_provider:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\DataProviders\SpecialDataProvider
        arguments: ['@mbh.package.search', '@mbh.online.special_result_creator' ,'@mbh.online.query_generator','%online_booking%']

    mbh.additional_data_provider:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\DataProviders\AdditionalDataProvider
        arguments: ['@mbh.online.search_adapter', '@mbh.online.additional_result_creator' ,'@mbh.online.query_generator','%online_booking%']

###
    mbh.online.common_result_creator:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\ResultCreaters\CommonCreator

    mbh.online.special_result_creator:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\ResultCreaters\SpecialCreator

    mbh.online.additional_result_creator:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\ResultCreaters\AdditionalCreator
###
    mbh.online.foo_sorter:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\Sorters\FooSorter

    mbh.online.common_sorter:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\Sorters\CommonSorterByPrice

    mbh.online.special_sorter:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\Sorters\SpecialByDateSorter

    mbh.online.additional_sorter:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\Sorters\AdditionalSorter

###
    mbh.online.query_generator:
        public: false
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\SearchQuery\OnlineSearchQueryGenerator
        arguments: ["%mbh_cache%"]
###
    mbh.online_result_instance:
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineSearchHelper\OnlineResultInstance
        shared: false
        arguments: ['@doctrine_mongodb.odm.document_manager', '%online_left_rooms%']


    mbh.online_booking_notificator:
        class: MBH\Bundle\OnlineBookingBundle\Service\OnlineBookingNotificator
        arguments:
            - '@mbh.online.booking_logger'
            - '@mbh.notifier'
            - '@mbh.notifier.mailer'
            - '@translator.default'
            - '%mailer_user_arrival_links%'
            - '%online_reservation_manager_email%'
            - '@doctrine_mongodb.odm.default_document_manager'

    mbh.online.booking_logger_handler:
        class: Monolog\Handler\StreamHandler
        arguments: ["%kernel.logs_dir%/%kernel.environment%.online-booking.log", 200]
        public: false

    mbh.online.booking_logger:
        class: Monolog\Logger
        arguments: ['online-booking']
        calls:
            - [pushHandler, ['@mbh.online.booking_logger_handler']]

    mbh.online_booking.azovsky_converter:
        class: MBH\Bundle\OnlineBookingBundle\Service\SpecialAzovskyConverter
        arguments:
            - '@mbh.online.special_data_preparer'
            - '%online_booking%'
            - '@assets.packages'
            - '@twig.extension.httpfoundation'
            - '@liip_imagine.templating.filter_helper'
            - '@doctrine.odm.mongodb.document_manager'