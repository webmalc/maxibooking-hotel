<?php


use Doctrine\ODM\MongoDB\DocumentManager;
use MBH\Bundle\SearchBundle\Document\SearchConditions;
use MBH\Bundle\SearchBundle\Form\SearchConditionsType;
use Symfony\Component\Form\Test\TypeTestCase;

class SearchConditionsTypeTest extends TypeTestCase
{
    private $documentManager;

    protected function setUp()
    {
        $this->documentManager = $this->createMock(DocumentManager::class);
        parent::setUp(); // TODO: Change the autogenerated stub
    }

    protected function getExtensions()
    {
        return parent::getExtensions(); // TODO: Change the autogenerated stub
    }

    /**
     * @dataProvider getTestData
     */
    public function testSubmit($data)
    {
        $form = $this->factory->create(SearchConditionsType::class);
        $objectData = $data['objectData'];
        $object = new SearchConditions();
        $object
            ->setBegin($objectData['begin'])
            ->setEnd($objectData['end'])
            ->setAdults($objectData['adults'])
            ->setChildren($objectData['children']);

        $formData = $data['formData'];
        $form->submit($formData);

        $this->assertTrue($form->isSynchronized());
        $this->assertEquals($object, $form->getData());
    }

    public function getTestData()
    {
        yield
        [
            'good' =>
                [
                    'formData' => [
                        'begin' => '21.04.2018',
                        'end' => '22.04.2018',
                        'adults' => 3,
                        'children' => 4,
                    ],
                    'objectData' => [
                        'begin' => new \DateTime('2018-04-21 midnight'),
                        'end' => new \DateTime('2018-04-22 midnight'),
                        'adults' => 3,
                        'children' => 4,
                    ],

                ],
//            'bad' =>
//                [
//                    'data' => [
//                        'begin' => null,
//                        'end' => null,
//                        'adults' => null,
//                        'children' => null,
//                    ],
//                ],
        ];
    }
}