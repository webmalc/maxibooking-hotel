<?php


use Doctrine\Common\Collections\ArrayCollection;
use Doctrine\ODM\MongoDB\DocumentManager;
use MBH\Bundle\BaseBundle\Lib\Test\WebTestCase;
use MBH\Bundle\HotelBundle\Document\RoomType;
use MBH\Bundle\SearchBundle\Document\SearchConditions;
use MBH\Bundle\SearchBundle\Services\SearchQueryGenerator;

class SearchQueryGeneratorTest extends WebTestCase
{
    /** @var DocumentManager */
    private $dm;

    public function setUp()
    {
        $this->dm = $this->getContainer()->get('doctrine_mongodb.odm.default_document_manager');
        parent::setUp(); // TODO: Change the autogenerated stub
    }

    public function testGenerate()
    {
        $roomTypes = $this->dm->getRepository(RoomType::class)->findAll();
        $generator = new SearchQueryGenerator();
        $conditions = new SearchConditions();
        $conditions
            ->setBegin(new \DateTime('2018-04-21 midnight'))
            ->setEnd(new \DateTime('2018-04-22 midnight'))
            ->setAdults(3)
            ->setChildren(4)
            ->setRoomTypes(new ArrayCollection(array_values($roomTypes)))
        ;
        $generator->generate($conditions);

        $this->assertEquals(3, $generator->getQueuesNum());
        $this->assertEquals('this is must be hash', $generator->getSearchQueryHash());

    }
}